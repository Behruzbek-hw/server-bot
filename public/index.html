<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minecraft Bot Control</title>
  <style>
  body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background-color: #1a1a1a;
  color: #e0e0e0;
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  line-height: 1.6;
}

h1, h2 {
  color: #ffffff;
  font-weight: 600;
  margin-bottom: 1.5rem;
}

.section {
  background-color: #252525;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

label {
  display: block;
  margin-bottom: 8px;
  font-size: 0.9rem;
  color: #a0a0a0;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  background-color: #2f2f2f;
  border: 1px solid #3a3a3a;
  border-radius: 4px;
  color: #e0e0e0;
  font-size: 1rem;
  transition: border-color 0.2s ease;
}

input:focus, select:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
}

button {
  background-color: #4a90e2;
  color: #ffffff;
  border: none;
  padding: 10px 20px;
  border-radius: 4px;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

button:hover {
  background-color: #357abd;
}

#statusLog {
  background-color: #2f2f2f;
  border: 1px solid #3a3a3a;
  border-radius: 4px;
  padding: 15px;
  height: 200px;
  overflow-y: auto;
  font-family: 'Fira Code', 'Consolas', monospace;
  font-size: 0.9rem;
  color: #d0d0d0;
}

#botList {
  list-style: none;
  padding: 0;
}

#botList li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  background-color: #2f2f2f;
  border-radius: 4px;
  margin-bottom: 10px;
}

#botList li button {
  background-color: #e04a4a;
}

#botList li button:hover {
  background-color: #bd3535;
}

/* Scrollbar styling for status log */
#statusLog::-webkit-scrollbar {
  width: 8px;
}

#statusLog::-webkit-scrollbar-track {
  background: #2f2f2f;
}

#statusLog::-webkit-scrollbar-thumb {
  background: #4a90e2;
  border-radius: 4px;
}

#statusLog::-webkit-scrollbar-thumb:hover {
  background: #357abd;
}
  </style>
</head>
<body>
  <h1>Minecraft 1 Bot Control</h1>

  <div class="section">
    <h2>Add Bot</h2>
    <label for="botUsername">Bot Username:</label>
    <input type="text" id="botUsername" placeholder="Bot Username">
    <label for="botPassword">Bot Password (optional):</label>
    <input type="text" id="botPassword" placeholder="Bot Password">
    <label for="serverHost">Server Host:</label>
    <input type="text" id="serverHost" placeholder="Server IP or hostname">
    <label for="serverPort">Server Port:</label>
    <input type="number" id="serverPort" placeholder="Server Port" value="25565">
    <label for="reloginInterval">Relogin Interval (minutes, 0 to disable):</label>
    <input type="number" id="reloginInterval" placeholder="Relogin interval" min="0">
    <button onclick="addBot()">Add Bot</button>
  </div>

  <div class="section">
    <h2>Bots</h2>
    <ul id="botList"></ul>
  </div>

  <div class="section">
    <h2>Send Command</h2>
    <label for="botSelect">Select Bot:</label>
    <select id="botSelect"></select>
    <label for="command">Command:</label>
    <input type="text" id="command" placeholder="Enter command">
    <button onclick="sendCommand()">Send</button>
  </div>

  <div class="section">
    <h2>Status Log</h2>
    <div id="statusLog"></div>
  </div>

  <script>
    // WebSocket ulanishini dinamik ravishda aniqlash
    const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    let ws;

    function connectWebSocket() {
      ws = new WebSocket(`${protocol}${window.location.host}`);
      
      ws.onopen = () => {
        console.log('WebSocket connected');
        const log = document.getElementById('statusLog');
        log.innerHTML += `<p>[${new Date().toLocaleString()}] WebSocket connected</p>`;
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'bots') {
          const botList = document.getElementById('botList');
          const botSelect = document.getElementById('botSelect');
          botList.innerHTML = '';
          botSelect.innerHTML = '';
          data.bots.forEach(bot => {
            const li = document.createElement('li');
            li.textContent = `${bot.username} (${bot.server.host}:${bot.server.port}) `;
            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Remove';
            removeBtn.onclick = () => removeBot(bot.username);
            li.appendChild(removeBtn);
            botList.appendChild(li);

            const option = document.createElement('option');
            option.value = bot.username;
            option.textContent = `${bot.username} (${bot.server.host}:${bot.server.port})`;
            botSelect.appendChild(option);
          });
        } else if (data.type === 'status') {
          const log = document.getElementById('statusLog');
          log.innerHTML += `<p>[${new Date().toLocaleString()}] ${data.username}: ${data.status}</p>`;
          log.scrollTop = log.scrollHeight;
        } else if (data.type === 'error') {
          alert(data.message);
        }
      };

      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
        const log = document.getElementById('statusLog');
        log.innerHTML += `<p>[${new Date().toLocaleString()}] WebSocket error: ${error.message || 'Connection failed'}</p>`;
        // 5 soniyadan keyin qayta ulanishga urinish
        setTimeout(connectWebSocket, 5000);
      };

      ws.onclose = () => {
        console.log('WebSocket closed');
        const log = document.getElementById('statusLog');
        log.innerHTML += `<p>[${new Date().toLocaleString()}] WebSocket connection closed. Reconnecting...</p>`;
        // 5 soniyadan keyin qayta ulanishga urinish
        setTimeout(connectWebSocket, 5000);
      };
    }

    // Ilova boshlanganda WebSocket ulanishini boshlash
    connectWebSocket();

    function addBot() {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        alert('WebSocket is not connected. Please try again later.');
        return;
      }
      const username = document.getElementById('botUsername').value;
      const password = document.getElementById('botPassword').value;
      const serverHost = document.getElementById('serverHost').value;
      const serverPort = parseInt(document.getElementById('serverPort').value) || 25565;
      const reloginInterval = parseInt(document.getElementById('reloginInterval').value) || 0;
      if (username && serverHost && serverPort) {
        ws.send(JSON.stringify({ 
          type: 'addBot', 
          username, 
          password, 
          server: { host: serverHost, port: serverPort }, 
          reloginInterval 
        }));
      } else {
        alert('Please fill in username, server host, and port');
      }
    }

    function removeBot(username) {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        alert('WebSocket is not connected. Please try again later.');
        return;
      }
      ws.send(JSON.stringify({ type: 'removeBot', username }));
    }

    function sendCommand() {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        alert('WebSocket is not connected. Please try again later.');
        return;
      }
      const username = document.getElementById('botSelect').value;
      const command = document.getElementById('command').value;
      if (username && command) {
        ws.send(JSON.stringify({ type: 'sendCommand', username, command }));
      }
    }
  </script>
</body>
</html>
