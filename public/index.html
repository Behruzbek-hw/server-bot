<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Minecraft Bot Control</title>
  <style>
    /* Dark Mode Minimalistic Style */
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background-color: #121212;
  color: #e0e0e0;
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  line-height: 1.6;
}

h1, h2 {
  color: #ffffff;
  margin-bottom: 10px;
  font-weight: 600;
}

.section {
  background: #1e1e1e;
  border: 1px solid #2c2c2c;
  border-radius: 10px;
  padding: 15px 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

label {
  display: block;
  margin-bottom: 6px;
  font-size: 14px;
  color: #bbbbbb;
}

input, select, button {
  width: 100%;
  margin-bottom: 12px;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #2c2c2c;
  background-color: #2a2a2a;
  color: #f0f0f0;
  font-size: 14px;
  outline: none;
  transition: 0.2s;
}

input:focus, select:focus {
  border-color: #4a90e2;
  background-color: #333333;
}

button {
  background-color: #4a90e2;
  border: none;
  color: white;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.2s;
}

button:hover {
  background-color: #357ab8;
}

#statusLog {
  background: #1a1a1a;
  border: 1px solid #2c2c2c;
  padding: 10px;
  height: 200px;
  overflow-y: auto;
  border-radius: 8px;
  font-family: monospace;
  font-size: 13px;
  color: #b0b0b0;
}

#botList li {
  margin-bottom: 8px;
  padding: 8px;
  background: #2a2a2a;
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#botList button {
  width: auto;
  padding: 6px 12px;
  background: #e74c3c;
  border: none;
  border-radius: 6px;
  color: white;
  font-size: 13px;
  cursor: pointer;
  transition: background 0.2s;
}

#botList button:hover {
  background: #c0392b;
}

.form-group {
  margin-bottom: 15px;
}

.form-inline {
  display: flex;
  gap: 10px;
  align-items: flex-end;
}

.form-inline input, .form-inline select, .form-inline button {
  flex: 1;
}

.form-inline .btn-container {
  flex: 0 0 auto;
}

  </style>
</head>
<body>
  <h1>Minecraft 1 Bot Control</h1>

  <div class="section">
    <h2>Add Bot</h2>
    <div class="form-group">
      <label for="botUsername">Bot Username:</label>
      <input type="text" id="botUsername" placeholder="Bot Username">
    </div>

    <div class="form-group">
      <label for="botPassword">Bot Password (optional):</label>
      <input type="text" id="botPassword" placeholder="Bot Password">
    </div>

    <div class="form-group">
      <label for="serverAddress">Server Address (host:port):</label>
      <input type="text" id="serverAddress" placeholder="example.com:25565">
    </div>

    <div class="form-inline">
      <div>
        <label for="reloginInterval">Relogin Interval (minutes, 0 = disable):</label>
        <input type="number" id="reloginInterval" placeholder="0">
      </div>
      <div class="btn-container">
        <button onclick="addBot()">Add Bot</button>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>Bots</h2>
    <ul id="botList"></ul>
  </div>

  <div class="section">
    <h2>Send Command</h2>
    <div class="form-inline">
      <select id="botSelect"></select>
      <input type="text" id="command" placeholder="Enter command">
      <button onclick="sendCommand()">Send</button>
    </div>
  </div>

  <div class="section">
    <h2>Status Log</h2>
    <div id="statusLog"></div>
  </div>

  <script>
        // WebSocket ulanishini dinamik ravishda aniqlash
    const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    let ws;

    function connectWebSocket() {
      ws = new WebSocket(`${protocol}${window.location.host}`);
      
      ws.onopen = () => {
        console.log('WebSocket connected');
        const log = document.getElementById('statusLog');
        log.innerHTML += `<p>[${new Date().toLocaleString()}] WebSocket connected</p>`;
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        if (data.type === 'bots') {
          const botList = document.getElementById('botList');
          const botSelect = document.getElementById('botSelect');
          botList.innerHTML = '';
          botSelect.innerHTML = '';
          data.bots.forEach(bot => {
            const li = document.createElement('li');
            li.textContent = `${bot.username} (${bot.server.host}:${bot.server.port}) `;
            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'Remove';
            removeBtn.onclick = () => removeBot(bot.username);
            li.appendChild(removeBtn);
            botList.appendChild(li);

            const option = document.createElement('option');
            option.value = bot.username;
            option.textContent = `${bot.username} (${bot.server.host}:${bot.server.port})`;
            botSelect.appendChild(option);
          });
        } else if (data.type === 'status') {
          const log = document.getElementById('statusLog');
          log.innerHTML += `<p>[${new Date().toLocaleString()}] ${data.username}: ${data.status}</p>`;
          log.scrollTop = log.scrollHeight;
        } else if (data.type === 'error') {
          alert(data.message);
        }
      };

      ws.onerror = (error) => {
        console.error('WebSocket error:', error);
        const log = document.getElementById('statusLog');
        log.innerHTML += `<p>[${new Date().toLocaleString()}] WebSocket error: ${error.message || 'Connection failed'}</p>`;
        // 5 soniyadan keyin qayta ulanishga urinish
        setTimeout(connectWebSocket, 5000);
      };

      ws.onclose = () => {
        console.log('WebSocket closed');
        const log = document.getElementById('statusLog');
        log.innerHTML += `<p>[${new Date().toLocaleString()}] WebSocket connection closed. Reconnecting...</p>`;
        // 5 soniyadan keyin qayta ulanishga urinish
        setTimeout(connectWebSocket, 5000);
      };
    }

    // Ilova boshlanganda WebSocket ulanishini boshlash
    connectWebSocket();

    function addBot() {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        alert('WebSocket is not connected. Please try again later.');
        return;
      }
      const username = document.getElementById('botUsername').value;
      const password = document.getElementById('botPassword').value;
      const serverHost = document.getElementById('serverHost').value;
      const serverPort = parseInt(document.getElementById('serverPort').value) || 25565;
      const reloginInterval = parseInt(document.getElementById('reloginInterval').value) || 0;
      if (username && serverHost && serverPort) {
        ws.send(JSON.stringify({ 
          type: 'addBot', 
          username, 
          password, 
          server: { host: serverHost, port: serverPort }, 
          reloginInterval 
        }));
      } else {
        alert('Please fill in username, server host, and port');
      }
    }

    function removeBot(username) {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        alert('WebSocket is not connected. Please try again later.');
        return;
      }
      ws.send(JSON.stringify({ type: 'removeBot', username }));
    }

    function sendCommand() {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        alert('WebSocket is not connected. Please try again later.');
        return;
      }
      const username = document.getElementById('botSelect').value;
      const command = document.getElementById('command').value;
      if (username && command) {
        ws.send(JSON.stringify({ type: 'sendCommand', username, command }));
      }
    }
  </script>
</body>
</html>
